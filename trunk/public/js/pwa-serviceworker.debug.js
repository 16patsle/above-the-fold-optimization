!function(r,u){function R(a,b,g){return caches.open(t).then(function(d){var c={};return b.headers.forEach(function(a,b){c[b]=a}),c["x-abtf-sw"]=p(),g&&g.max_age&&(c["x-abtf-sw-expire"]=g.max_age),b.blob().then(function(e){e=new Response(e,{status:b.status,statusText:b.statusText,headers:c});return d.put(a,e)})})}function G(a){if(a)return"string"==typeof a&&(a=new Request(a,{mode:"no-cors"})),y(a).then(function(b){return b?b:(console.info("Abtf.sw() \u27a4 preload",a.url),v(a,{conditions:null},!1,
!0))})}function y(a){var b=m.start(1E3);return caches.open(t).then(function(g){return g.match(a).then(function(d){if(d){var c=d.headers.get("x-abtf-sw-expire");if(c)var e=d.headers.get("x-abtf-sw");var f=d.headers.get("expire");f&&(f=B(f));c&&e<p()-c?(d=!1,console.info("Abtf.sw() \u27a4 cache expired by policy",a.url,"max age:",c)):f&&f<p()&&(d=!1,console.info("Abtf.sw() \u27a4 cache expired by HTTP expire",a.url,d.headers.get("expire")))}return m.complete(b),d})})}function H(a,b){return a=new Request(a),
y(a).then(function(a){return a?a.blob().then(function(b){return new Response(b,{status:503,statusText:"Offline",headers:a.headers})}):u(b)["catch"](function(a){setTimeout(function(){throw a;})})})}function v(a,b,g,d){var c,e=m.start(1E3);return(c=a.headers.get("accept"),c&&c.includes("text/html")?new Promise(function(a){caches.open(t+":push").then(function(b){b.keys().then(function(b){if(0===b.length)return a(null);var c=[];b.forEach(function(a){c.push(y(a))});Promise.all(c).then(function(c){var e=
[];b.forEach(function(a,b){"undefined"!==c[b]&&c[b]&&e.push(a.url)});0===e.length?a(null):S(e,Math.pow(2,7)).then(function(b){a(b)})})})})}):Promise.resolve(null)).then(function(c){function h(a){a in l&&(l[a]&&l[a][2]&&clearTimeout(l[a][2]),l[a]=!1,delete l[a])}var f=a;c&&(f=new Request(f)).headers.set("cache-digest",c);var k=f.url;if(!d&&l&&k in l&&l[k]&&l[k][0]>p()-5)return console.info("Abtf.sw() \u27a4 hook into preload initiated request",k),l[k][1];c=u(f).then(function(a){h(k);var c=!1;if(a.ok&&
400>a.status){var d=a.headers.get("link");d&&(d instanceof Array||(d=[d]),m.f(function(){caches.open(t+":push").then(function(a){d.forEach(function(c){c.split(",").forEach(function(c){if(/rel=preload/.test(c)){var b=c.match(/<([^>]+)>/);b&&b[1]&&a.match(b[1]).then(function(c){c||a.put(b[1],new Response(null,{status:204}))})}})})})},1E3));b&&(c=!0,b.conditions&&(b.conditions.forEach(function(b){if(c)switch(b.type){case "url":b.regex?(e=C(b.pattern))?(e=e.test(f.url),b.not?e&&(c=!1):e||(c=!1)):c=!1:
(e=-1!==f.url.indexOf(b.pattern),b.not?e&&(c=!1):e||(c=!1));break;case "header":var e,d=a.headers.get(b.name);if(d)if(b.regex)(e=C(b.pattern))?(e=e.test(d),b.not?e&&(c=!1):e||(c=!1)):c=!1;else if("object"==typeof b.pattern)if(b.pattern.operator){var d=parseFloat(d),h=parseFloat(b.pattern.value);if(isNaN(d)||isNaN(h))c=!1;else{switch(b.pattern.operator){case "<":e=d<h;break;case ">":e=d>h;break;case "=":e=d===h;break;default:c=!1}c&&(b.not?e&&(c=!1):e||(c=!1))}}else c=!1;else-1===d.indexOf(b.pattern)&&
(c=!1);else c=!1}}),c?console.info("Abtf.sw() \u27a4 cache condition \u27a4 cache",f.url,b.conditions):console.info("Abtf.sw() \u27a4 cache condition \u27a4 no cache",f.url,b.conditions)),c&&R(f,a.clone(),b).then(function(){m.complete(e)}))}return c||m.complete(e),a})["catch"](function(a){return h(k),m.complete(e),g?g(f,null,a):null});return d&&(l[k]=[p(),c],l[k][2]=setTimeout(function(){l[k]=!1;delete l[k]},5E3)),c})}function N(){J||(!K||K<p()-10)&&(J=!0,K=p(),caches.keys().then(function(a){return a&&
0!==a.length?Promise.all(a.map(function(a){if(0!==a.indexOf(t))return console.info("Abtf.sw() \u27a4 old cache deleted",a),caches["delete"](a);caches.open(a).then(function(b){b.keys().then(function(d){if(console.info("Abtf.sw() \u27a4 prune cache",a,"size:",d.length,z),!(d.length<z)){var c=[],e=[],f=[];return d.forEach(function(a){e.push(a);f.push(b.match(a))}),Promise.all(f).then(function(a){var d=p();(a.forEach(function(a,f){if(a&&a.headers){var h=a.headers.get("x-abtf-sw");if(h){var k=a.headers.get("x-abtf-sw-expire");
if(k&&h&&h<p()-k)return console.info("Abtf.sw() \u27a4 cache \u27a4 expired",a.url),void b["delete"](e[f])}else h=d;!1!==c&&c.push({t:h,r:e[f]})}}),c&&c.length>z)&&(c.sort(function(a,c){return a.t>c.t?-1:a.t<c.t?1:0}),c.slice(z).forEach(function(a){b["delete"](a.r)}))})}})})})).then(function(){J=!1}):Promise.resolve()}))}function C(a){if(a=a.match(T)){try{var b=new RegExp(a[1],a[2])}catch(g){}return b||!1}}function B(a){if(a)return isNaN(parseInt(a))?(a=Date.parse(a),isNaN(a)?void 0:Math.round(a/
1E3)):a}function p(){return Math.round(Date.now()/1E3)}function D(){return w?Promise.resolve():(O(),w=!0,u(E+"?"+Math.round(Date.now()/1E3),{mode:"no-cors"}).then(function(a){if(w=!1,a&&a.ok&&400>a.status)return a.json().then(function(a){if(console.info("Abtf.sw() \u27a4 config "+(q?"updated":"loaded"),a),a){a instanceof Array&&(a={policy:a});t="abtf";a.cache_version&&(t=t+":"+a.cache_version);a.policy&&(q=a.policy,A=p());var b=[],d=[];return a.start_url&&d.push(G(a.start_url)),a.policy&&a.policy.forEach(function(a){a.offline&&
-1===b.indexOf(a.offline)&&b.push(a.offline)}),a.preload&&a.preload.forEach(function(a){-1===b.indexOf(a)&&b.push(a)}),preloadPromises=[],b.forEach(function(a){preloadPromises.push(G(a))}),Promise.all(d)}});throw q=!1,Error("service worker config not found: "+E);})["catch"](function(a){q=w=!1;setTimeout(function(){throw a;})}))}function P(a){(new Promise(function(b){if(!q||!A||a&&a>A){var g=!q;D().then(function(){g&&b(q||!1)})["catch"](function(){g&&b(!1)})}else if(!w&&A<p()-300){O();w=!0;var d=new Request(E+
"?"+Math.round(Date.now()/1E3),{method:"HEAD",mode:"no-cors"});u(d).then(function(a){w=!1;var b=!0;a&&a.ok&&(a=B(a.headers.get("last-modified")))&&a<=A&&(b=!1);b&&D()})["catch"](function(){w=!1;D()})}else b(q)}))["catch"](function(a){setTimeout(function(){throw a;})})}function O(){var a=new URL(location);(L=a.searchParams.get("path"))||(L="/");(a=a.searchParams.get("config"))||(a="abtf-pwa-config.json");E=L+a}var L,E,t,q=!1,A=!1,z=1E3,l={};r.addEventListener("install",function(a){a.waitUntil(D().then(function(){r.skipWaiting()})["catch"](function(){r.skipWaiting()}))});
r.addEventListener("activate",function(){r.clients.claim()});CacheStorage.prototype.match||(CacheStorage.prototype.match=function(a,b){var g=this;return this.keys().then(function(d){var c;return d.reduce(function(e,d){return e.then(function(){return c||g.open(d).then(function(c){return c.match(a,b)}).then(function(a){return c=a})})},Promise.resolve())})});var x,Q,n,M,w,S=function(){function a(){this.value=[];this.a=0}function b(a,b){return a-b}function g(c,e){if(e>=Math.pow(2,32))throw Error('Invalid probability: "${p}" must be smaller than 2**32');
if(!(0<(f=e)&&(f&1+~f)===f))throw Error('Invalid probability: "${p}" must be a power of 2');var f,h,I=Math.min(Math.pow(2,Math.round(Math.log2(c.length))),Math.pow(2,31)),k=[];return new Promise(function(f){Promise.all(c.map(function(a){return b=a,c=I,f=e,new Promise(function(a){var e=b.replace(/[!'()*]/g,function(a){return"%"+a.charCodeAt(0).toString(16)});crypto.subtle.digest("SHA-256",d.encode(e)).then(function(b){b=(new DataView(b)).getUint32(0);var e=Math.log2(c*f);if(31<e)throw Error("This implementation only supports up to 31 bit hash values");
a(b>>32-e&(1<<e)-1)})});var b,c,f})).then(function(){k=k.concat().sort(b);h=Uint8Array.from((new a).c(Math.log2(I),5).c(Math.log2(e),5).g(k,Math.log2(e)).value);var c;c="";for(var d=h.byteLength,g=0;g<d;g++)c+=String.fromCharCode(h[g]);c=btoa(c).replace(/=+$/,"");f(c)})})}a.prototype.b=function(a){0==this.a&&(this.value.push(0),this.a=8);--this.a;a&&(this.value[this.value.length-1]|=1<<this.a)};a.prototype.c=function(a,b){if(0!=b){do--b,this.b(a&1<<b);while(0!=b)}return this};a.prototype.g=function(a,
b){for(var c=-1,e=0;e!=a.length;++e)if(c!=a[e]){for(var c=a[e]-c-1,d=c>>b;0!=d;--d)this.b(0);this.b(1);this.c(c,b);c=a[e]}return this};var d=new TextEncoder("utf-8");return function(a,b){return g(a,b)}}(),m=(x={},Q=0,n=[],{start:function(a){var b=++Q;return x[b]=[Date.now(),a],b},complete:function(a){try{delete x[a]}catch(b){}0<n.length&&M(null,0)},f:M=function(a,b,g){var d=!1,c=Object.keys(x);if(0<c.length){var e=Date.now();c.forEach(function(a){if(!d)if(x[a][0]<e-x[a][1])try{delete x[a]}catch(k){}else d=
!0})}if(d){if(0!==b){var f;if(g){var h=!1;n.forEach(function(a,b){h||a[2]==g&&(h=b)});h&&(n[h][1]&&clearTimeout(n[h][1]),f=h)}f||(f=n.push([])-1);n[f]=[a,setTimeout(function(a,b){delete n[a];b();0<n.length&&M(null,0)},b,f,a),g]}}else if(a&&n.push([a]),0<n.length)for(a=n.shift();a;){if(a instanceof Array){a[1]&&clearTimeout(a[1]);try{a[0]()}catch(I){}}a=n.shift()}}}),T=/^\/(.*)\/([gimuy]+)?$/,K=!1,J=!1,F=!1;r.addEventListener("fetch",function(a){if("GET"===a.request.method){var b=!1;if(["wp-admin/",
"wp-login.php"].forEach(function(d){b||(d=new RegExp("^([^/]+)?//"+r.location.host+"(:[0-9]+)?/"+d),(d.test(a.request.url)||a.request.referrer&&d.test(a.request.referrer))&&(b=!0))}),!(b||a.request.url.match(/\&preview=true/)||a.request.url.match(/\&preview_nonce=/))&&(P(),q&&t)){var g=function(a,b){if(!b||0===b.length)return!1;var c=!1;if(b.forEach(function(b){if(!c&&b.match&&0!==b.match.length){var d=!0;b.match.forEach(function(b){if(d)switch(b.type){case "url":if(b.regex)if(h=C(b.pattern)){var c=
h.test(a.request.url);b.not?c&&(d=!1):c||(d=!1)}else d=!1;else if(b.pattern instanceof Array){var e=!1;b.pattern.forEach(function(b){e||-1!==a.request.url.indexOf(b)&&(e=!0)});b.not?e&&(d=!1):e||(d=!1)}else c=-1!==a.request.url.indexOf(b.pattern),b.not?c&&(d=!1):c||(d=!1);break;case "header":switch(b.name.toLowerCase()){case "referer":case "referrer":var f=a.request.referrer;break;default:f=a.request.headers.get(b.name)}if(f)if(b.regex){var h;(h=C(b.pattern))?(c=h.test(f),b.not?c&&(d=!1):c||(d=!1)):
d=!1}else c=-1!==f.indexOf(b.pattern),b.not?c&&(d=!1):c||(d=!1);else b.not||(d=!1)}});d&&(c=b)}}),!c)return console.info("Abtf.sw() \u27a4 policy \u27a4 no match",a.request.url),!1;switch(console.info("Abtf.sw() \u27a4 policy \u27a4 match",a.request.url,c),F&&clearTimeout(F),F=setTimeout(function(){m.f(N,1E4,"clean-cache");F=!1},100),c.strategy){case "never":return!1;case "cache":return y(a.request).then(function(b){if(b){var d=!0,e=c.cache.update_interval?!isNaN(parseInt(c.cache.update_interval))&&
parseInt(c.cache.update_interval):!1;if(e){var f=b.headers.get("x-abtf-sw");f&&parseInt(f)>p()-e&&(d=!1)}return d&&(g=a.request.clone(),l=b.clone(),setTimeout(function(){var a;if(c.cache.h&&(a=function(){clients.matchAll().then(function(a){a.forEach(function(a){a.postMessage([2,g.url])})})}),c.cache.head_update)console.info("Abtf.sw() \u27a4 HEAD \u27a4 verify",g.url),function(a,b,c,d){var e=c.headers.get("etag"),f=B(c.headers.get("last-modified"));if(!e&&!f)return console.warn("Abtf.sw() \u27a4 HEAD \u27a4 no etag or last-modified",
a.url),c=v(a,b),d&&(c=c.then(d)),c;var g=m.start(1E3);c=new Request(a.url,{method:"HEAD",headers:a.headers,mode:"no-cors"});u(c).then(function(c){var h=!1,k=c.headers.get("etag");c=B(c.headers.get("last-modified"));return(k&&k!==e?h=!0:c&&c!==f&&(h=!0),h)?(console.info("Abtf.sw() \u27a4 HEAD \u27a4 update",a.url),h=v(a,b),h=h.then(function(a){return m.complete(g),a}),d&&(h=h.then(d)),h):(m.complete(g),null)})["catch"](function(){var c=v(a,b);return c=c.then(function(a){return m.complete(g),a}),d&&
(c=c.then(d)),c})}(g,c.cache,l,a);else{console.info("Abtf.sw() \u27a4 update cache",g.url);var b=v(g,c.cache);a&&b.then(a)}},10)),console.info("Abtf.sw() \u27a4 from cache",a.request.url),b}return v(a.request,c.cache,function(b,d,e){return c.offline?(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 offline page",b.url),H(c.offline,b.clone())):(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 empty 404 response",b.url,d,e),d||u(a.request.clone())["catch"](function(a){setTimeout(function(){throw a;
})}))});var g,l});case "event":return y(a.request).then(function(b){return b?(console.info("Abtf.sw() \u27a4 from cache",a.request.url),b):v(a.request,null,function(b,d){return c.offline?(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 offline page",b.url),H(c.offline,b.clone())):(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 empty 404 response",b.url,d),d||u(a.request)["catch"](function(a){setTimeout(function(){throw a;})}))})});default:return v(a.request,
c.cache,function(b,d,e){return console.warn("Abtf.sw() \u27a4 network failed",b.url,d||e),y(b).then(function(e){return e?(console.info("Abtf.sw() \u27a4 fallback from cache",b.url),e):c.offline?(console.warn("Abtf.sw() \u27a4 no cache \u27a4 offline page",b.url),H(c.offline,b.clone())):(console.warn("Abtf.sw() \u27a4 no cache \u27a4 empty 404 response",b.url),d||u(a.request)["catch"](function(a){setTimeout(function(){throw a;})}))})})}}(a,q);if(!1!==g)return a.respondWith(g)}}});r.addEventListener("message",
function(a){if(a&&a.data&&a.data instanceof Array){if(1===a.data[0]&&(a.data[1]&&!isNaN(parseInt(a.data[1]))&&P(parseInt(a.data[1])),a.data[3]&&!isNaN(parseInt(a.data[3]))&&(z=parseInt(a.data[3])),m.f(N,1E4,"clean-cache")),2===a.data[0]||3===a.data[0])var b=a.ports[0]?function(b,d){a.ports[0].postMessage({error:b,status:d})}:!1;var g;if(2===a.data[0])if(a.data[1])if("string"==typeof a.data[1]||a.data[1]instanceof Request?g=[a.data[1]]:a.data[1]instanceof Array&&(g=a.data[1]),g){var d=[];g.forEach(function(a){d.push(G(a))});
b&&Promise.all(d).then(function(a){var c=[];a.forEach(function(a){var b={url:a.url,status:a.status,statusText:a.statusText};a=a.headers.get("content-length");b.size=isNaN(parseInt(a))?-1:parseInt(a);c.push(b)});b(null,c)})["catch"](function(a){console.error("Abtf.sw() \u27a4 preload",a)})}else b&&b("invalid-data");else b&&b("no-urls");3===a.data[0]&&(r.registration.showNotification(a.data[1],a.data[2]),b&&b(null,"sent"))}})}(self,self.fetch,Cache);
